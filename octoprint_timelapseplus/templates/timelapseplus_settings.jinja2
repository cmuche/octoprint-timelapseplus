<form class="form-horizontal" id="timelapseplus-settings" style="margin-right: 1em">

    <ul class="nav nav-pills">
        <li class="active"><a data-toggle="tab" href="#timelapseplus-settings-tab-info">Info</a></li>
        <li><a data-toggle="tab" href="#timelapseplus-settings-tab-pathsandwebcam">Paths/Webcam</a></li>
        <li><a data-toggle="tab" href="#timelapseplus-settings-tab-general">General</a></li>
        <li><a data-toggle="tab" href="#timelapseplus-settings-tab-purging">Purging</a></li>
        <li><a data-toggle="tab" href="#timelapseplus-settings-tab-stabilization">Stabilization</a></li>
        <li><a data-toggle="tab" href="#timelapseplus-settings-tab-enhancement">Enhancement</a></li>
        <li><a data-toggle="tab" href="#timelapseplus-settings-tab-rendering">Rendering</a></li>
    </ul>
    <hr />

    <div class="tab-content">
        <div class="tab-pane active" id="timelapseplus-settings-tab-info">
            <h3>Timelapse+</h3>
            <h4>Version <span data-bind="text: settings.plugins.timelapseplus.pluginVersion"></span></h4>
            <div class="alert alert-block" style="margin-top: 2em;margin-bottom: 2em">
                <strong>Need Help?</strong>
                If you are unsure which options to choose or how to start, you can visit the Wiki which also includes a 'Getting Started Guide'.
                You are always welcome to open an issue on GitHub when you might find a bug, want a feature to be added to Timelapse+, need help or just have a question about this plugin.
                <br><br>
                <a href="https://github.com/cmuche/octoprint-timelapseplus/wiki" target="_blank" class="btn btn-mini">
                    <i class="fa fa-book"></i>
                    Read the Wiki
                </a>
                <a href="https://github.com/cmuche/octoprint-timelapseplus/issues/new" target="_blank" class="btn btn-mini">
                    <i class="fa fa-plus"></i>
                    Open an Issue
                </a>
            </div>
            <a class="btn btn-mini" href="/plugin/timelapseplus/downloadLog" target="_blank">
                <i class="fa fa-scroll"></i>
                View Log File
            </a>
            <a class="btn btn-mini" href="https://plugins.octoprint.org/plugins/timelapseplus" target="_blank">
                <i class="fa fa-globe"></i>
                Plugin Homepage
            </a>
            <a class="btn btn-mini" href="https://github.com/cmuche/octoprint-timelapseplus" target="_blank">
                <i class="fa fa-github"></i>
                GitHub Page
            </a>
        </div>
        <div class="tab-pane" id="timelapseplus-settings-tab-pathsandwebcam">
            <h3>Paths and Webcam</h3>
            <div class="control-group">
                <label class="control-label">FFmpeg Path</label>
                <div class="controls">
                    <input type="text" data-bind="value: settings.plugins.timelapseplus.ffmpegPath">
                    <span class="help-block">The path to the FFmpeg binary. You need to install it manually on your host machine.</span>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">FFprobe Path</label>
                <div class="controls">
                    <input type="text" data-bind="value: settings.plugins.timelapseplus.ffprobePath">
                    <span class="help-block">Usually FFprobe is located in the same folder as FFmpeg.</span>
                </div>
            </div>

            <hr>

            <div class="control-group">
                <label class="control-label">Webcam Type</label>
                <div class="controls">
                    <select data-bind="value: settings.plugins.timelapseplus.webcamType">
                        <option value="PLUGIN">Webcam Plugin</option>
                        <option value="IMAGE_JPEG">JPEG Image</option>
                        <option value="STREAM_MJPEG">MJPEG Stream</option>
                        <option value="STREAM_MP4">MP4 Stream (via FFmpeg)</option>
                        <option value="STREAM_HLS">HLS Stream (Via FFmpeg)</option>
                        <option value="SCRIPT">Custom Script</option>
                    </select>
                    <span class="help-block" data-bind="visible: (settings.plugins.timelapseplus.webcamType() == 'STREAM_MP4' || settings.plugins.timelapseplus.webcamType() == 'STREAM_HLS' || settings.plugins.timelapseplus.webcamType() == 'STREAM_MJPEG')">
                        Stream-based capturing might take some extra time to be processed and converted which could have an impact on your snapshot timing.<br>
                    </span>
                </div>
            </div>

            <div class="control-group" data-bind="visible: settings.plugins.timelapseplus.webcamType() == 'PLUGIN'">
                <label class="control-label">Plugin</label>
                <div class="controls">
                    <select data-bind="value: settings.plugins.timelapseplus.webcamPluginId, options: parent.allWebcams, optionsText: 'name', optionsValue: 'id', valueAllowUnset: true">
                    </select>
                </div>
            </div>

            <div class="control-group" data-bind="visible: settings.plugins.timelapseplus.webcamType() != 'SCRIPT' && settings.plugins.timelapseplus.webcamType() != 'PLUGIN'">
                <label class="control-label">Webcam URL</label>
                <div class="controls">
                    <input type="text" data-bind="value: settings.plugins.timelapseplus.webcamUrl">
                    <span class="help-block">The URL must be reachable for OctoPrint and return a still image or the stream in the format specified above.</span>
					<BR>
					<span class="help-block">To pass <a href="https://en.wikipedia.org/wiki/Basic_access_authentication">Basic HTTP Auth</a> credentials, use the following URL format:<BR>http://&lt;username&gt;:&lt;password&gt;@&lt;ipAddressOrHostName&gt;:&lt;portNumber&gt;
                </div>
            </div>
            <div class="control-group" data-bind="visible: settings.plugins.timelapseplus.webcamType() != 'SCRIPT' && settings.plugins.timelapseplus.webcamType() != 'PLUGIN'">
                <label class="control-label"><a href="https://en.wikipedia.org/wiki/Self-signed_certificate">Self-signed SSL Cert</a><BR>or <a href="https://en.wikipedia.org/wiki/Root_certificate">Root CA</a> for validation</label>
                <div class="controls">
                    <input type="text" data-bind="value: settings.plugins.timelapseplus.webcamPathToCertVerifyFile">
                    <span class="help-block">If your webcam uses HTTPS and has a custom SSL certificate/bundle for SSL validation, upload it to your Octoprint server and paste the full path to the file or folder here. The certificate must be:
						<ol>
							<li>Encoded in <a href="https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail">PEM format</a>.</li>
							<li>Have proper file permissions so that Octoprint userID can access it.</li>
						</ol>
					</span>
                </div>
            </div>
            <div class="control-group" data-bind="visible: settings.plugins.timelapseplus.webcamType() == 'SCRIPT'">
                <label class="control-label">Webcam Script Path</label>
                <div class="controls">
                    <input type="text" data-bind="value: settings.plugins.timelapseplus.webcamUrl">
                    <span class="help-block">
                        Supported Script Types are:
                        <ul>
                            <li>Linux Bash Script (*.sh)</li>
                            <li>Windows Batch Script (*.bat)</li>
                            <li>Windows PowerShell Script (*.ps1)</li>
                        </ul>
                        Timelapse+ will pass a file path as an argument to the script. Your script needs to create the snapshot as a <strong>jpg</strong> file at this location.
                    </span>
                </div>
            </div>

            <hr>

            <div class="control-group">
                <label class="control-label">Test Settings</label>
                <div class="controls">
                    <span class="help-block">You can test the FFmpeg and FFprobe paths as well as the snapshot capture here:</span>
                    <button id="tlp-button-webcam-preview" style="margin-top: 1em" class="btn btn-mini" data-bind="click: function(){parent.openWebcamCapturePreview(settings.plugins.timelapseplus.ffmpegPath, settings.plugins.timelapseplus.ffprobePath, settings.plugins.timelapseplus.webcamType, settings.plugins.timelapseplus.webcamUrl,settings.plugins.timelapseplus.webcamPathToCertVerifyFile, settings.plugins.timelapseplus.webcamPluginId)}">
                        <i class="fa fa-check"></i>
                        Test Paths and Webcam Settings
                    </button>
                </div>
            </div>
        </div>
        <div class="tab-pane" id="timelapseplus-settings-tab-general">
            <h3>General</h3>
            <div class="control-group">
                <label class="control-label">Enable Capturing</label>
                <div class="controls">
                    <input type="checkbox" class="input-block-level" data-bind="checked: settings.plugins.timelapseplus.enabled">
                </div>
            </div>

            <hr>

            <div class="control-group">
                <label class="control-label">Capture Mode</label>
                <div class="controls">
                    <select data-bind="value: settings.plugins.timelapseplus.captureMode">
                        <option value="COMMAND">Command</option>
                        <option value="TIMED">Timer</option>
                    </select>
                </div>
            </div>

            <div class="control-group" data-bind="visible: settings.plugins.timelapseplus.captureMode() == 'COMMAND'">
                <label class="control-label">Snapshot Command</label>
                <div class="controls">
                    <input type="text" data-bind="value: settings.plugins.timelapseplus.snapshotCommand">
                    <span class="help-block">Action Command or @-Command that will trigger a snapshot capture. You'll have to include it in your GCODE where you want a snapshot to be triggered.</span>
                    <code class="block">; Example GCODE

                        ; @-Command like this:
                        @<span data-bind="text: settings.plugins.timelapseplus.snapshotCommand"></span>

                        ; Or Action Command like this:
                        M118 A1 action:<span data-bind="text: settings.plugins.timelapseplus.snapshotCommand"></span>

                        ; Pause Snapshot Capturing:
                        @<span data-bind="text: settings.plugins.timelapseplus.snapshotCommand"></span>-PAUSE
                        ; Resume Snapshot Capturing:
                        @<span data-bind="text: settings.plugins.timelapseplus.snapshotCommand"></span>-RESUME
                        ; Explicitly non-stabilized Snapshot:
                        @<span data-bind="text: settings.plugins.timelapseplus.snapshotCommand"></span>-UNSTABLE
                    </code>
                </div>
            </div>

            <div class="control-group" data-bind="visible: settings.plugins.timelapseplus.captureMode() == 'TIMED'">
                <label class="control-label">Timer Interval</label>
                <div class="controls">
                    <input type="number" step='1' min="1" max="600" width="5" data-bind="value: settings.plugins.timelapseplus.captureTimerInterval">
                    <span class="help-block">Capture Timer Interval in seconds</span>
                </div>
            </div>

            <hr>

            <div class="control-group">
                <label class="control-label">Show Snapshot Details</label>
                <div class="controls">
                    <input type="checkbox" class="input-block-level" data-bind="checked: settings.plugins.timelapseplus.snapshotInfo">
                    <span class="help-block">Display a small image next to the current snapshot showing what was printed since the last snapshot along snapshot-, queuing- and parking positions.</span>
                </div>
            </div>

            <div class="control-group" data-bind="visible: settings.plugins.timelapseplus.snapshotInfo">
                <label class="control-label">Snapshot Details Frame</label>
                <div class="controls">
                    <select data-bind="value: settings.plugins.timelapseplus.snapshotInfoFrame">
                        <option value="ZOOM_ALL">Zoom to Everything</option>
                        <option value="ZOOM_MODEL">Zoom to Model</option>
                        <option value="PRINTER_VOLUME">Use Printer Profile Volume</option>
                    </select>
                </div>
            </div>

            <hr>

            <div class="control-group">
                <label class="control-label">Render Multithreading</label>
                <div class="controls">
                    <input type="checkbox" class="input-block-level" data-bind="checked: settings.plugins.timelapseplus.renderMultithreading">
                    <span class="help-block">Frame operations in Render Jobs will be executed in parallel.</span>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">Render Video after Print</label>
                <div class="controls">
                    <input type="checkbox" class="input-block-level" data-bind="checked: settings.plugins.timelapseplus.renderAfterPrint">
                    <span class="help-block">When a Print has finished a Render Job will be started with the default Video Format, the first Enhancement Preset and the first Render Preset defined below.</span>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">Compress Frame Collections</label>
                <div class="controls">
                    <input type="checkbox" class="input-block-level" data-bind="checked: settings.plugins.timelapseplus.compressFrameZips">
                    <span class="help-block">Generated Frame Collections won't be compressed by default. Checking this option compresses the Frame Collections after a print has finished. This means lower disk space consumption but adds some time compressing at the end of a print and OctoPrint will stay in the 'Finishing' state during that.</span>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">Default Video Output Format</label>
                <div class="controls">
                    <select data-bind="valueAllowUnset: true, foreach: parent.videoFormatsGrouped, value: settings.plugins.timelapseplus.defaultVideoFormat">
                        <optgroup data-bind="attr: {label: name}, foreach: children">
                            <option data-bind="text: fullName, value: $data.id"></option>
                        </optgroup>
                    </select>
                    <span class="help-block">Maybe not all formats are available on your system or your used FFmpeg version. Please consider changing the Video Format if a Render Job is not successful.</span>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">Force Capturing</label>
                <div class="controls">
                    <input type="checkbox" class="input-block-level" data-bind="checked: settings.plugins.timelapseplus.forceCapturing">
                    <span class="help-block">Start the Capturing Process when a Print Job starts even if there are errors. <strong>Normally, DO NOT use this option unless you really need to.</strong></span>
                </div>
            </div>
        </div>
        <div class="tab-pane" id="timelapseplus-settings-tab-purging">
            <h3>Purging</h3>
            <div class="control-group">
                <label class="control-label">Delete Videos</label>
                <div class="controls">
                    <input type="checkbox" class="input-block-level" data-bind="checked: settings.plugins.timelapseplus.purgeVideos">
                </div>
            </div>
            <div class="control-group" data-bind="visible: settings.plugins.timelapseplus.purgeVideos">
                <label class="control-label">Days</label>
                <div class="controls">
                    <input type="number" step='1' min="1" max="300" width="5" data-bind="value: settings.plugins.timelapseplus.purgeVideosDays">
                    <span class="help-block">
                <span>Rendered Videos older than</span>
                <strong data-bind="text: settings.plugins.timelapseplus.purgeVideosDays"></strong>
                <span>days will be automatically removed.</span>
            </span>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">Delete Frame Collections</label>
                <div class="controls">
                    <input type="checkbox" class="input-block-level" data-bind="checked: settings.plugins.timelapseplus.purgeFrameCollections">
                </div>
            </div>
            <div class="control-group" data-bind="visible: settings.plugins.timelapseplus.purgeFrameCollections">
                <label class="control-label">Days</label>
                <div class="controls">
                    <input type="number" step='1' min="1" max="300" width="5" data-bind="value: settings.plugins.timelapseplus.purgeFrameCollectionsDays">
                    <span class="help-block">
                <span>Captured Frame Collections older than</span>
                <strong data-bind="text: settings.plugins.timelapseplus.purgeFrameCollectionsDays"></strong>
                <span>days will be automatically removed.</span>
            </span>
                </div>
            </div>
        </div>
        <div class="tab-pane" id="timelapseplus-settings-tab-stabilization">
            <h3>Stabilization (Beta)</h3>

            <ul class="nav nav-pills">
                <li class="active"><a data-toggle="tab" href="#timelapseplus-settings-stab-info">General</a></li>
                <li data-bind="visible: settings.plugins.timelapseplus.stabilization"><a data-toggle="tab" href="#timelapseplus-settings-stab-printer">Printer</a></li>
                <li data-bind="visible: settings.plugins.timelapseplus.stabilization"><a data-toggle="tab" href="#timelapseplus-settings-stab-parkposition">Parking Position</a></li>
                <li data-bind="visible: settings.plugins.timelapseplus.stabilization"><a data-toggle="tab" href="#timelapseplus-settings-stab-movement">Movement</a></li>
                <li data-bind="visible: settings.plugins.timelapseplus.stabilization"><a data-toggle="tab" href="#timelapseplus-settings-stab-retraction">Retraction</a></li>
                <li data-bind="visible: settings.plugins.timelapseplus.stabilization"><a data-toggle="tab" href="#timelapseplus-settings-stab-infilllookahead">Infill Look-Ahead</a></li>
                <li data-bind="visible: settings.plugins.timelapseplus.stabilization"><a data-toggle="tab" href="#timelapseplus-settings-stab-oozingcompensation">Oozing</a></li>
            </ul>

            <div class="tab-content">
                <div class="tab-pane active" id="timelapseplus-settings-stab-info">
                    <div class="alert alert-block">
                        <strong>Note:</strong>
                        This feature is currently under development. Please keep in mind that problems may occur or certain
                        functionalities may not work properly. If you encounter any issues, have feedback
                        or suggestions for improvement, please share them in a GitHub Issue.
                        Your input would greatly help in advancing and refining this feature. Thank you!
                    </div>
                    <div class="control-group">
                        <span class="help-block" style="margin-bottom: 2em">
                            The stabilization feature will park your print head in a certain position before taking a screenshot.
                            As a result, you will get a much smoother timelapse since the print head and heat bed will be in a controlled
                            position and won't jump around in your captured snapshots. Stabilization only works with the <i>Command Capture Mode</i>.
                            <strong>eep in mind that this will affect your print and printer movements, potentially influencing your print quality.</strong>
                            <br><br>
                            Disclaimer: Be cautious when making changes here, as they could lead to unwanted behavior and potentially damage your print or printer.
                        </span>
                        <label class="control-label">Enable Stabilization</label>
                        <div class="controls">
                            <input type="checkbox" class="input-block-level" data-bind="checked: settings.plugins.timelapseplus.stabilization">
                        </div>
                    </div>
                </div>
                <div data-bind="visible: settings.plugins.timelapseplus.stabilization" class="tab-pane" id="timelapseplus-settings-stab-printer">
                    <h4>Printer</h4>
                    <h5>Firmware</h5>
                    <div class="control-group">
                        <label class="control-label">G90/G91 Extruder Overwrite</label>
                        <div class="controls">
                            <input type="checkbox" class="input-block-level" data-bind="checked: settings.plugins.timelapseplus.stabilizationSettings.gcodeG90G91ExtruderOverwrite">
                            <span class="help-block">
                                Activate this if the extruder mode is also set by <code>G90</code>/<code>G91</code> commands.
                                The GCODE Commands <code>G90</code> and <code>G91</code> define if movement commands should be interpreted as relative or absolute values.
                                In some firmwares (e.g. Marlin-based firmwares) this also sets this behavior for the extruder (which can exclusively be set via <code>M82</code>/<code>M83</code> commands).
                            </span>
                        </div>
                    </div>
                    <h5>Limits</h5>
                    <div class="control-group">
                        <label class="control-label">Min X</label>
                        <div class="controls">
                        <span class="input-append">
                            <input type="number" step='0.1' min="0" max="1000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.printerXMin">
                        <span class="add-on">mm</span>
                        </span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Max X</label>
                        <div class="controls">
                        <span class="input-append">
                            <input type="number" step='0.1' min="0" max="1000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.printerXMax">
                        <span class="add-on">mm</span>
                        </span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Min Y</label>
                        <div class="controls">
                        <span class="input-append">
                            <input type="number" step='0.1' min="0" max="1000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.printerYMin">
                        <span class="add-on">mm</span>
                        </span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Max Y</label>
                        <div class="controls">
                        <span class="input-append">
                            <input type="number" step='0.1' min="0" max="1000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.printerYMax">
                        <span class="add-on">mm</span>
                        </span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Max Z</label>
                        <div class="controls">
                        <span class="input-append">
                            <input type="number" step='0.1' min="0" max="1000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.printerZMax">
                        <span class="add-on">mm</span>
                        </span>
                        </div>
                    </div>
                    <h5>Home Position</h5>
                    <span class="help-block" style="margin-bottom: 2em">
                        This is the position to which the printer returns after a <code>G28</code> (home axes) command.
                    </span>
                    <div class="control-group">
                        <label class="control-label">Home X</label>
                        <div class="controls">
                        <span class="input-append">
                            <input type="number" step='0.1' min="0" max="1000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.printerHomeX">
                        <span class="add-on">mm</span>
                        </span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Home Y</label>
                        <div class="controls">
                        <span class="input-append">
                            <input type="number" step='0.1' min="0" max="1000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.printerHomeY">
                        <span class="add-on">mm</span>
                        </span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Home Z</label>
                        <div class="controls">
                        <span class="input-append">
                            <input type="number" step='0.1' min="0" max="1000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.printerHomeZ">
                        <span class="add-on">mm</span>
                        </span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Auto-Detection</label>
                        <div class="controls">
                            <button class="btn" data-bind="click: parent.openHomeAutoDetect">
                                <i class="fa fa-external-link-square-alt"></i>
                                Open Auto-Detection Wizard
                            </button>
                            <span class="help-block">
                            An Auto-Detection of the Home Position can be done. Click the button to get more information.
                        </span>
                        </div>
                    </div>
                </div>
                <div data-bind="visible: settings.plugins.timelapseplus.stabilization" class="tab-pane" id="timelapseplus-settings-stab-parkposition">
                    <h4>Parking Position</h4>
                    <h5>X-Value</h5>
                    <div class="control-group">
                        <label class="control-label">Type</label>
                        <div class="controls">
                            <select data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.parkXType">
                                <option value="FIXED">Fixed</option>
                                <option value="RELATIVE">Relative</option>
                                <option value="SWEEP">Animation</option>
                            </select>
                        </div>
                    </div>
                    <div class="control-group" data-bind="visible: settings.plugins.timelapseplus.stabilizationSettings.parkXType() == 'FIXED'">
                        <label class="control-label">Value</label>
                        <div class="controls">
                        <span class="input-append">
                            <input type="number" step='0.1' min="-1000" max="1000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.parkX">
                        <span class="add-on">mm</span>
                        </span>
                        </div>
                    </div>

                    <div class="control-group" data-bind="visible: settings.plugins.timelapseplus.stabilizationSettings.parkXType() == 'RELATIVE'">
                        <label class="control-label">Offset</label>
                        <div class="controls">
                        <span class="input-append">
                            <input type="number" step='0.1' min="-1000" max="1000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.parkX">
                        <span class="add-on">mm</span>
                        </span>
                        </div>
                    </div>

                    <div data-bind="visible: settings.plugins.timelapseplus.stabilizationSettings.parkXType() == 'SWEEP'">
                        <div class="control-group">
                            <label class="control-label">Effect</label>
                            <div class="controls">
                                <select data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.parkXSweepFn">
                                    <option value="LINEAR">Linear Sweep</option>
                                    <option value="INOUT">Sine Sweep</option>
                                    <option value="BOUNCE">Bounce</option>
                                    <option value="RANDOM">Randomized</option>
                                    <option value="CYCLIC_SINE">Sine Cyclic</option>
                                    <option value="CYCLIC_SINE_REDUCING">Sine Cyclic Reducing</option>
                                    <option value="CYCLIC_LINEAR">Linear Cyclic</option>
                                    <option value="CYCLIC_LINEAR_REDUCING">Linear Cyclic Reducing</option>
                                    <option value="CYCLIC_SAWTOOTH">Sawtooth</option>
                                </select>
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label">Start Value</label>
                            <div class="controls">
                        <span class="input-append">
                            <input type="number" step='0.1' min="-1000" max="1000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.parkXSweepFrom">
                        <span class="add-on">mm</span>
                        </span>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">End Value</label>
                            <div class="controls">
                        <span class="input-append">
                            <input type="number" step='0.1' min="-1000" max="1000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.parkXSweepTo">
                        <span class="add-on">mm</span>
                        </span>
                            </div>
                        </div>
                        <div class="control-group" data-bind="visible: settings.plugins.timelapseplus.stabilizationSettings.parkXSweepFn().startsWith('CYCLIC_')">
                            <label class="control-label">Cycles</label>
                            <div class="controls">
                                <input type="number" step='1' min="1" max="50" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.parkXSweepCycles">
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">Preview</label>
                            <div class="controls">
                                <img style="width:15em" data-bind="attr: {src: '/plugin/timelapseplus/stabilizationEaseFnPreview?fn=' + settings.plugins.timelapseplus.stabilizationSettings.parkXSweepFn() + '&cycles=' + settings.plugins.timelapseplus.stabilizationSettings.parkXSweepCycles()}">
                            </div>
                        </div>
                    </div>

                    <h5>Y-Value</h5>
                    <div class="control-group">
                        <label class="control-label">Type</label>
                        <div class="controls">
                            <select data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.parkYType">
                                <option value="FIXED">Fixed</option>
                                <option value="RELATIVE">Relative</option>
                                <option value="SWEEP">Animation</option>
                            </select>
                        </div>
                    </div>
                    <div class="control-group" data-bind="visible: settings.plugins.timelapseplus.stabilizationSettings.parkYType() == 'FIXED'">
                        <label class="control-label">Value</label>
                        <div class="controls">
                        <span class="input-append">
                            <input type="number" step='0.1' min="-1000" max="1000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.parkY">
                        <span class="add-on">mm</span>
                        </span>
                        </div>
                    </div>

                    <div class="control-group" data-bind="visible: settings.plugins.timelapseplus.stabilizationSettings.parkYType() == 'RELATIVE'">
                        <label class="control-label">Offset</label>
                        <div class="controls">
                        <span class="input-append">
                            <input type="number" step='0.1' min="-1000" max="1000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.parkY">
                        <span class="add-on">mm</span>
                        </span>
                        </div>
                    </div>

                    <div data-bind="visible: settings.plugins.timelapseplus.stabilizationSettings.parkYType() == 'SWEEP'">
                        <div class="control-group">
                            <label class="control-label">Effect</label>
                            <div class="controls">
                                <select data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.parkYSweepFn">
                                    <option value="LINEAR">Linear Sweep</option>
                                    <option value="INOUT">Sine Sweep</option>
                                    <option value="BOUNCE">Bounce</option>
                                    <option value="RANDOM">Randomized</option>
                                    <option value="CYCLIC_SINE">Sine Cyclic</option>
                                    <option value="CYCLIC_SINE_REDUCING">Sine Cyclic Reducing</option>
                                    <option value="CYCLIC_LINEAR">Linear Cyclic</option>
                                    <option value="CYCLIC_LINEAR_REDUCING">Linear Cyclic Reducing</option>
                                    <option value="CYCLIC_SAWTOOTH">Sawtooth</option>
                                </select>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">Start Value</label>
                            <div class="controls">
                        <span class="input-append">
                            <input type="number" step='0.1' min="-1000" max="1000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.parkYSweepFrom">
                        <span class="add-on">mm</span>
                        </span>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">End Value</label>
                            <div class="controls">
                        <span class="input-append">
                            <input type="number" step='0.1' min="-1000" max="1000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.parkYSweepTo">
                        <span class="add-on">mm</span>
                        </span>
                            </div>
                        </div>
                        <div class="control-group" data-bind="visible: settings.plugins.timelapseplus.stabilizationSettings.parkYSweepFn().startsWith('CYCLIC_')">
                            <label class="control-label">Cycles</label>
                            <div class="controls">
                                <input type="number" step='1' min="1" max="50" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.parkYSweepCycles">
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">Preview</label>
                            <div class="controls">
                                <img style="width:15em" data-bind="attr: {src: '/plugin/timelapseplus/stabilizationEaseFnPreview?fn=' + settings.plugins.timelapseplus.stabilizationSettings.parkYSweepFn() + '&cycles=' + settings.plugins.timelapseplus.stabilizationSettings.parkYSweepCycles()}">
                            </div>
                        </div>
                    </div>

                    <h5>Z-Value</h5>
                    <div class="control-group">
                        <label class="control-label">Relative</label>
                        <div class="controls">
                            <input type="checkbox" class="input-block-level" data-bind="checked: settings.plugins.timelapseplus.stabilizationSettings.parkZRelative">
                        </div>
                    </div>
                    <div class="control-group" data-bind="visible: !settings.plugins.timelapseplus.stabilizationSettings.parkZRelative()">
                        <label class="control-label">Value</label>
                        <div class="controls">
                        <span class="input-append">
                            <input type="number" step='0.1' min="0" max="1000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.parkZ">
                        <span class="add-on">mm</span>
                        </span>
                        </div>
                    </div>
                    <div class="control-group" data-bind="visible: settings.plugins.timelapseplus.stabilizationSettings.parkZRelative()">
                        <label class="control-label">Offset</label>
                        <div class="controls">
                        <span class="input-append">
                            <input type="number" step='0.1' min="0" max="1000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.parkZ">
                        <span class="add-on">mm</span>
                        </span>
                        </div>
                    </div>
                    <div class="alert alert-block" style="margin-top: 1em" data-bind="visible: !settings.plugins.timelapseplus.stabilizationSettings.parkZRelative()">
                        <strong>Warning: </strong>
                        If you use an absolute Z-Value you <strong>must</strong> ensure that this value is larger than the height of your printed object!
                        Otherwise, your print head may collide with your print.
                    </div>
                </div>
                <div data-bind="visible: settings.plugins.timelapseplus.stabilization" class="tab-pane" id="timelapseplus-settings-stab-movement">
                    <h4>Movement</h4>
                    <div class="control-group">
                        <label class="control-label">Move Speed</label>
                        <div class="controls">
                        <span class="input-append">
                            <input type="number" step='1' min="1" max="1000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.moveSpeed">
                            <span class="add-on">mm/s</span>
                        </span>
                            <span class="help-block">
                            The print head will be moved to its parking position with this speed.
                        </span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Wait for Movement (M400)</label>
                        <div class="controls">
                            <input type="checkbox" class="input-block-level" data-bind="checked: settings.plugins.timelapseplus.stabilizationSettings.waitForMovement">
                            <span class="help-block">
                                Add a <code>M400</code> command before taking a snapshot which prevents the printer from executing commands before the parking movement has finished.
                            </span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Wait before</label>
                        <div class="controls">
                        <span class="input-append">
                            <input type="number" step='1' min="0" max="5000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.waitBefore">
                            <span class="add-on">ms</span>
                        </span>
                            <span class="help-block">
                            Wait this long when the print head is parked and before taking a snapshot.
                            Increase this value if your snapshot is taken too early.
                        </span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Wait after</label>
                        <div class="controls">
                        <span class="input-append">
                            <input type="number" step='1' min="0" max="5000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.waitAfter">
                            <span class="add-on">ms</span>
                        </span>
                            <span class="help-block">
                            Wait this long when the snapshot is taken and before returning to the print.
                            Increase this value if your camera needs more time to take a snapshot.
                        </span>
                        </div>
                    </div>
                </div>
                <div data-bind="visible: settings.plugins.timelapseplus.stabilization" class="tab-pane" id="timelapseplus-settings-stab-retraction">
                    <h4>Retraction</h4>
                    <span class="help-block" style="margin-bottom: 2em">
                        When moving to the parking position, a retraction will be performed and before the print is resumed, a re-retraction will be performed.
                        Configure these values for your printer.
                    </span>
                    <div class="control-group">
                        <label class="control-label">Retraction Speed</label>
                        <div class="controls">
                        <span class="input-append">
                            <input type="number" step='1' min="1" max="1000" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.retractSpeed">
                            <span class="add-on">mm/s</span>
                        </span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Retraction Amount</label>
                        <div class="controls">
                        <span class="input-append">
                            <input type="number" step='0.01' min="0.12" max="10" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.retractAmount">
                            <span class="add-on">mm</span>
                        </span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Retraction Z-Hop</label>
                        <div class="controls">
                        <span class="input-append">
                            <input type="number" step='0.01' min="0.00" max="10" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.retractZHop">
                            <span class="add-on">mm</span>
                        </span>
                        </div>
                    </div>
                </div>
                <div data-bind="visible: settings.plugins.timelapseplus.stabilization" class="tab-pane" id="timelapseplus-settings-stab-infilllookahead">
                    <h4>Infill Look-Ahead</h4>
                    <span class="help-block" style="margin-bottom: 2em">
                        To minimize the impact of the stabilization process on print quality, Timelapse+ attempts to perform stabilized snapshot capturing
                        during the printing of infill rather than perimeters. Your GCODE file will be scanned when a print is started and Timelapse+
                        tries to identify the locations of infill blocks. Your slicer must include the infill block information in the generated GCODE file.
                        If a snapshot is triggered and requires stabilization, Timelapse+ then attempts to delay the capturing process until your
                        printer reaches the next infill printing stage. If there are no further infill sections before the subsequent snapshot,
                        Timelapse+ will proceed with immediate snapshot capturing.
                    </span>
                    <div class="control-group">
                        <label class="control-label">Enable Infill Look-Ahead</label>
                        <div class="controls">
                            <input type="checkbox" class="input-block-level" data-bind="checked: settings.plugins.timelapseplus.stabilizationSettings.infillLookahead">
                        </div>
                    </div>
                </div>
                <div data-bind="visible: settings.plugins.timelapseplus.stabilization" class="tab-pane" id="timelapseplus-settings-stab-oozingcompensation">
                    <h4>Oozing Compensation</h4>
                    <span class="help-block" style="margin-bottom: 2em">
                        While the print head is parked, it is almost inevitable for your nozzle to experience some filament oozing during the movement process.
                        To mitigate this, Timelapse+ has the ability to calculate the expected duration of the parking and capturing process, as well
                        as the amount of filament likely to ooze out during that time. When retracting before parking, this extra filament will be
                        retracted as well. However, exercise caution with this feature: setting the value too high can result in under-extrusion upon
                        resuming after a snapshot. It may require some experimentation to find the optimal value for your printer.
                    </span>
                    <div class="control-group">
                        <label class="control-label">Enable Oozing Compensation</label>
                        <div class="controls">
                            <input type="checkbox" class="input-block-level" data-bind="checked: settings.plugins.timelapseplus.stabilizationSettings.oozingCompensation">
                        </div>
                    </div>
                    <div class="control-group" data-bind="visible: settings.plugins.timelapseplus.stabilizationSettings.oozingCompensation">
                        <label class="control-label">Oozing Speed Value</label>
                        <div class="controls">
                        <span class="input-append">
                            <input type="number" step='0.01' min="0.01" max="10" width="5" data-bind="value: settings.plugins.timelapseplus.stabilizationSettings.oozingCompensationValue">
                            <span class="add-on">mm/s</span>
                        </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab-pane" id="timelapseplus-settings-tab-enhancement">
            <h3>Enhancement</h3>
            <div class="control-group">
                <label class="control-label">Enhancement Presets</label>
                <div class="controls">

                    <div class="help-block">Enhancement presets define how the frames should be optimized and filtered before the final video is rendered</div>

                    <button class="btn btn-mini" style="margin-top: 1em" data-bind="click: function(){parent.addEnhancementPreset(settings.plugins.timelapseplus.enhancementPresets)}">
                        <i class="fa fa-plus"></i>
                        Add Enhancement Preset
                    </button>

                    <div data-bind="foreach: settings.plugins.timelapseplus.enhancementPresets">
                        <div class="preset">
                            <h4 style="margin: 0">Preset #<span data-bind="text: $parent.parent.itemIndex($parent.settings.plugins.timelapseplus.enhancementPresets, $data) + 1"></span></h4>
                            <h5 data-bind="text: $data.name"></h5>

                            <button style="margin-right: 1em" class="btn btn-mini" data-bind="click: $parent.parent.openSettingsEnhancementPreset">
                                <i class="fa fa-cog"></i>
                                Edit Settings
                            </button>

                            <button class="btn btn-mini" data-bind="enable: $parent.parent.canMoveItemUp($parent.settings.plugins.timelapseplus.enhancementPresets, $data), click: function(){$parent.parent.moveItemUp($parent.settings.plugins.timelapseplus.enhancementPresets, $data)}">
                                <i class="fa fa-chevron-up"></i>
                            </button>
                            <button style="margin-right: 1em" class="btn btn-mini" data-bind="enable: $parent.parent.canMoveItemDown($parent.settings.plugins.timelapseplus.enhancementPresets, $data), click: function(){$parent.parent.moveItemDown($parent.settings.plugins.timelapseplus.enhancementPresets, $data)}">
                                <i class="fa fa-chevron-down"></i>
                            </button>
                            <button class="btn btn-mini" data-bind="click: function(){$parent.settings.plugins.timelapseplus.enhancementPresets.remove($data)}, enable: $parent.settings.plugins.timelapseplus.enhancementPresets().length > 1">
                                <i class="fa fa-trash"></i>
                                Remove
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab-pane" id="timelapseplus-settings-tab-rendering">
            <h3>Rendering</h3>
            <div class="control-group">
                <label class="control-label">Render Presets</label>
                <div class="controls">

                    <div class="help-block">Render presets define how the actual video should be rendered</div>

                    <button class="btn btn-mini" style="margin-top: 1em" data-bind="click: function(){parent.addRenderPreset(settings.plugins.timelapseplus.renderPresets)}">
                        <i class="fa fa-plus"></i>
                        Add Render Preset
                    </button>

                    <div data-bind="foreach: settings.plugins.timelapseplus.renderPresets">
                        <div class="preset">
                            <h4 style="margin: 0">Preset #<span data-bind="text: $parent.parent.itemIndex($parent.settings.plugins.timelapseplus.renderPresets, $data) + 1"></span></h4>
                            <h5 data-bind="text: $data.name"></h5>

                            <button style="margin-right: 1em" class="btn btn-mini" data-bind="click: $parent.parent.openSettingsRenderPreset">
                                <i class="fa fa-cog"></i>
                                Edit Settings
                            </button>

                            <button class="btn btn-mini" data-bind="enable: $parent.parent.canMoveItemUp($parent.settings.plugins.timelapseplus.renderPresets, $data), click: function(){$parent.parent.moveItemUp($parent.settings.plugins.timelapseplus.renderPresets, $data)}">
                                <i class="fa fa-chevron-up"></i>
                            </button>
                            <button style="margin-right: 1em" class="btn btn-mini" data-bind="enable: $parent.parent.canMoveItemDown($parent.settings.plugins.timelapseplus.renderPresets, $data), click: function(){$parent.parent.moveItemDown($parent.settings.plugins.timelapseplus.renderPresets, $data)}">
                                <i class="fa fa-chevron-down"></i>
                            </button>
                            <button class="btn btn-mini" data-bind="click: function(){$parent.settings.plugins.timelapseplus.renderPresets.remove($data)}, enable: $parent.settings.plugins.timelapseplus.renderPresets().length > 1">
                                <i class="fa fa-trash"></i>
                                Remove
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!------------------------------------------------------->

    <div id="tlp-modal-edit-enhancement-preset" class="modal hide fade tlp-preset-modal">
        <div class="modal-header">
            <a href="#" class="close" data-dismiss="modal" aria-hidden="true">&times;</a>
            <h3>Edit Enhancement Preset</h3>
        </div>
        <div class="modal-body">
            <div class="row-fluid" data-bind="if: parent.editPreEnhancement() != null">
                <div>
                    <label class="sub">Name</label>
                    <input type="text" data-bind="value: parent.editPreEnhancement().name">
                </div>

                <div>
                    <label class="sub checkbox">
                        <input type="checkbox" data-bind="checked: parent.editPreEnhancement().normalize">
                        Normalize Lighting
                    </label>
                    <span class="help-block" data-bind="visible: parent.editPreEnhancement().normalize">
                        Analyzes all frames and calculates the average brightness and contrast.
                        Then, the images will be corrected to normalize those values across all frames.
                        This is helpful when your snapshots have changing lighting conditions.
                    </span>
                </div>

                <div>
                    <label class="sub checkbox">
                        <input type="checkbox" data-bind="checked: parent.editPreEnhancement().enhance">
                        Enable Enhancing
                    </label>
                </div>

                <div class="sub-settings">
                    <div data-bind="visible: parent.editPreEnhancement().enhance">
                        <label class="sub">Brightness Factor</label>
                        <input type="number" step='0.01' min="0.01" max="5" width="5" data-bind="value: parent.editPreEnhancement().brightness">
                    </div>

                    <div data-bind="visible: parent.editPreEnhancement().enhance">
                        <label class="sub">Contrast Factor</label>
                        <input type="number" step='0.01' min="0.01" max="5" width="5" data-bind="value: parent.editPreEnhancement().contrast">
                    </div>

                    <div data-bind="visible: parent.editPreEnhancement().enhance">
                        <label class="sub checkbox">
                            <input type="checkbox" data-bind="checked: parent.editPreEnhancement().equalize">
                            Equalize Histogram
                        </label>
                    </div>
                </div>

                <div>
                    <label class="sub checkbox">
                        <input type="checkbox" data-bind="checked: parent.editPreEnhancement().blur">
                        Enable Blur
                    </label>
                </div>

                <div class="sub-settings">
                    <div data-bind="visible: parent.editPreEnhancement().blur">
                        <label class="sub">Blur Radius</label>
                        <input type="number" step='1' placeholder='0' min="1" max="500" width="5" data-bind="value: parent.editPreEnhancement().blurRadius">
                        <span class="help-block">The Blur Radius (in Pixels) defines how blurry the masked areas will be.</span>
                    </div>

                    <div data-bind="visible: parent.editPreEnhancement().blur">
                        <label class="sub">Mask</label>
                        <div>
                            <img style="width:8em" data-bind="visible: parent.editPreEnhancement().blurMask() != null, attr: {src: parent.editPreEnhancement().blurMask() == null ? '' : '/plugin/timelapseplus/maskPreview?id=' + parent.editPreEnhancement().blurMask()}">
                            <div data-bind="visible: parent.editPreEnhancement().blurMask() == null" style="color: red !important">
                                With Blur enabled you must provide a grayscale blur mask!
                            </div>
                        </div>
                        <button style="margin-top: 1em" class="btn" data-bind="click: parent.openBlurMask">Import Blur Mask</button>
                        <span class="help-block">Requires a grayscale image, ideally the same resolution as your webcam image. White areas define where the blur is applied on the frames, black areas mean no blur.</span>
                    </div>
                </div>

                <div>
                    <label class="sub checkbox">
                        <input type="checkbox" data-bind="checked: parent.editPreEnhancement().timecode">
                        Add Timecodes
                    </label>
                </div>
                <div class="sub-settings" data-bind="visible: parent.editPreEnhancement().timecode">
                    <div>
                        <label class="sub">Size</label>
                        <input type="number" step='1' placeholder='0' min="1" max="100" width="5" data-bind="value: parent.editPreEnhancement().timecodeSize">
                    </div>

                    <div>
                        <label class="sub">Margin</label>
                        <input type="number" step='1' placeholder='0' min="0" max="50" width="5" data-bind="value: parent.editPreEnhancement().timecodeMargin">
                    </div>

                    <div>
                        <label class="sub">Position</label>
                        <select data-bind="value: parent.editPreEnhancement().timecodeSnap">
                            <option value="TOP_LEFT">Top Left</option>
                            <option value="TOP_CENTER">Top Center</option>
                            <option value="TOP_RIGHT">Top Right</option>
                            <option value="CENTER_RIGHT">Center Right</option>
                            <option value="BOTTOM_RIGHT">Bottom Right</option>
                            <option value="BOTTOM_CENTER">Bottom Center</option>
                            <option value="BOTTOM_LEFT">Bottom Left</option>
                            <option value="CENTER_LEFT">Center Left</option>
                        </select>
                    </div>

                    <div>
                        <label class="sub">Type</label>
                        <select data-bind="value: parent.editPreEnhancement().timecodeType">
                            <option value="PRINTTIME_HMS">Print Time (H:M:S)</option>
                            <option value="PRINTTIME_HM">Print Time (H:M)</option>
                            <option value="PRINTTIME_HMS_LETTERS">Print Time (Hh Mm Ss)</option>
                            <option value="PRINTTIME_HM_LETTERS">Print Time (Hh Mm)</option>
                            <option value="TIME_HMS_24">Time 24 Hours (H:M:S)</option>
                            <option value="TIME_HM_24">Time 24 Hours (H:M)</option>
                            <option value="TIME_HMS_12">Time 12 Hours (H:M:S)</option>
                            <option value="TIME_HM_12">Time 12 Hours (H:M)</option>
                            <option value="PERCENT">Percent</option>
                            <option value="BAR">Progress Bar</option>
                            <option value="CLOCK_NOSECONDS">Analog Clock</option>
                            <option value="CLOCK">Analog Clock (with Seconds)</option>
                        </select>
                    </div>

                    <div>
                        <label class="sub">Primary Color</label>
                        <input type="color" maxlength="7" data-bind="value: parent.editPreEnhancement().timecodeColorPrimary">
                    </div>

                    <div>
                        <label class="sub">Secondary Color</label>
                        <input type="color" maxlength="7" data-bind="value: parent.editPreEnhancement().timecodeColorSecondary">
                    </div>
                </div>

                <button class="btn btn-mini" data-bind="click: parent.openEnhancementPresetPreview">
                    <i class="fa fa-eye"></i>
                    Live Preview
                </button>
            </div>

        </div>
        <div class="modal-footer">
            <button class="btn btn-primary pull-right" data-dismiss="modal">Close</button>
        </div>
    </div>

    <div id="tlp-modal-edit-render-preset" class="modal hide fade tlp-preset-modal">
        <div class="modal-header">
            <a href="#" class="close" data-dismiss="modal" aria-hidden="true">&times;</a>
            <h3>Edit Render Preset</h3>
        </div>
        <div class="modal-body">
            <div class="row-fluid" data-bind="if: parent.editPreRender() != null">
                <div>
                    <label class="sub">Name</label>
                    <input type="text" data-bind="value: parent.editPreRender().name">
                </div>

                <div>
                    <label class="sub">Framerate</label>
                    <input type="number" step='1' min="1" max="120" width="5" data-bind="value: parent.editPreRender().framerate">
                </div>

                <div>
                    <label class="sub checkbox">
                        <input type="checkbox" data-bind="checked: parent.editPreRender().resize">
                        Enable Resizing
                    </label>
                </div>
                <div class="sub-settings">
                    <div data-bind="visible: parent.editPreRender().resize">
                        <label class="sub">Width</label>
                        <input type="number" step='1' placeholder='0' min="10" max="5000" width="5" data-bind="value: parent.editPreRender().resizeW">
                    </div>

                    <div data-bind="visible: parent.editPreRender().resize">
                        <label class="sub">Height</label>
                        <input type="number" step='1' placeholder='0' min="10" max="5000" width="5" data-bind="value: parent.editPreRender().resizeH">
                    </div>
                </div>

                <div>
                    <label class="sub checkbox">
                        <input type="checkbox" data-bind="checked: parent.editPreRender().combine">
                        Combine Frames
                    </label>
                    <span class="help-block">Before rendering, multiple frames will be combined to reduce the number of total frames and by that the length of the final video.</span>
                </div>

                <div class="sub-settings">
                    <div data-bind="visible: parent.editPreRender().combine">
                        <label class="sub">Chunk Size</label>
                        <input type="number" step='1' min="2" max="100" width="5" data-bind="value: parent.editPreRender().combineSize">
                        <span class="help-block">Defines how many frames should be combined into one chunk.</span>
                    </div>

                    <div data-bind="visible: parent.editPreRender().combine">
                        <label class="sub">Method</label>
                        <select data-bind="value: parent.editPreRender().combineMethod">
                            <option value="DROP">Drop Frames</option>
                            <option value="BLEND">Blend</option>
                            <option value="BLEND_WEIGHTED">Weighted Blend</option>
                        </select>
                        <span class="help-block">When dropping frames, only the last frame of a combined chunk will be used, blending creates a combined frame by mixing all chunk frames into one.</span>
                    </div>
                </div>

                <div>
                    <label class="sub checkbox">
                        <input type="checkbox" data-bind="checked: parent.editPreRender().fade">
                        Enable Fade
                    </label>
                </div>

                <div class="sub-settings">
                    <div data-bind="visible: parent.editPreRender().fade">
                        <label class="sub">Fade-In Duration (ms)</label>
                        <input type="number" step='1' min="0" max="10000" width="5" data-bind="value: parent.editPreRender().fadeInDuration">
                    </div>

                    <div data-bind="visible: parent.editPreRender().fade">
                        <label class="sub">Fade-Out Duration (ms)</label>
                        <input type="number" step='1' min="0" max="10000" width="5" data-bind="value: parent.editPreRender().fadeOutDuration">
                    </div>

                    <div data-bind="visible: parent.editPreRender().fade">
                        <label class="sub">Color</label>
                        <input type="color" maxlength="7" data-bind="value: parent.editPreRender().fadeColor">
                    </div>
                </div>

                <div>
                    <label class="sub checkbox">
                        <input type="checkbox" data-bind="checked: parent.editPreRender().ppRoll">
                        Pre/Post Roll
                    </label>
                </div>

                <div class="sub-settings" data-bind="visible: parent.editPreRender().ppRoll">
                    <div>
                        <label class="sub">Max Blur Radius</label>
                        <input type="number" step='1' min="0" max="500" width="5" data-bind="value: parent.editPreRender().ppRollBlurRadius">
                    </div>

                    <div>
                        <label class="sub">Max Zoom Factor</label>
                        <input type="number" step='0.01' min="0.0" max="5.0" width="5" data-bind="value: parent.editPreRender().ppRollZoomFactor">
                    </div>

                    <h4>Pre-Roll</h4>
                    <div class="sub-settings">
                        <div>
                            <label class="sub">Duration (ms)</label>
                            <input type="number" step='1' min="0" max="10000" width="5" data-bind="value: parent.editPreRender().ppRollPreDuration">
                        </div>
                        <div>
                            <label class="sub">Type</label>
                            <select data-bind="value: parent.editPreRender().ppRollPreType">
                                <option value="STILL">Still Frame</option>
                                <option value="STILL_FINAL">Still Frame (Final)</option>
                                <option value="LAPSE">Short Timelapse</option>
                            </select>
                        </div>
                        <div>
                            <label class="sub">Ease Function</label>
                            <select data-bind="value: parent.editPreRender().ppRollPreEaseFn">
                                <option value="LINEAR">Linear</option>
                                <option value="EASE_IN">Ease-In</option>
                                <option value="EASE_IN_OUT">Ease-In-Out</option>
                                <span class="help-block">Animations during the Pre-Roll will be mapped by this function. Ease-In and Ease-In-Out will generate a much smoother transition between the Pre-Roll and the timelapse.</span>
                            </select>
                        </div>
                        <div>
                            <label class="sub checkbox">
                                <input type="checkbox" data-bind="checked: parent.editPreRender().ppRollPreZoom">
                                Zoom Animation
                            </label>
                        </div>
                        <div>
                            <label class="sub checkbox">
                                <input type="checkbox" data-bind="checked: parent.editPreRender().ppRollPreBlur">
                                Blur Animation
                            </label>
                        </div>
                    </div>

                    <h4>Post-Roll</h4>
                    <div class="sub-settings">
                        <div>
                            <label class="sub">Duration (ms)</label>
                            <input type="number" step='1' min="0" max="10000" width="5" data-bind="value: parent.editPreRender().ppRollPostDuration">
                        </div>
                        <div>
                            <label class="sub">Type</label>
                            <select data-bind="value: parent.editPreRender().ppRollPostType">
                                <option value="STILL">Still Frame</option>
                                <option value="STILL_FINAL">Still Frame (Final)</option>
                                <option value="LAPSE">Short Timelapse</option>
                            </select>
                        </div>
                        <div>
                            <label class="sub">Ease Function</label>
                            <select data-bind="value: parent.editPreRender().ppRollPostEaseFn">
                                <option value="LINEAR">Linear</option>
                                <option value="EASE_IN">Ease-In</option>
                                <option value="EASE_IN_OUT">Ease-In-Out</option>
                                <span class="help-block">Animations during the Post-Roll will be mapped by this function. Ease-In and Ease-In-Out will generate a much smoother transition between the timelapse and the Post-Roll.</span>
                            </select>
                        </div>
                        <div>
                            <label class="sub checkbox">
                                <input type="checkbox" data-bind="checked: parent.editPreRender().ppRollPostZoom">
                                Zoom Animation
                            </label>
                        </div>
                        <div>
                            <label class="sub checkbox">
                                <input type="checkbox" data-bind="checked: parent.editPreRender().ppRollPostBlur">
                                Blur Animation
                            </label>
                        </div>
                    </div>

                    <h4>Text</h4>
                    <label class="sub checkbox">
                        <input type="checkbox" data-bind="checked: parent.editPreRender().ppRollText">
                        Enable Pre-Roll Text
                        <span class="help-block">Show the source print file name or parts of it as a Pre-Roll text overlay</span>
                    </label>
                    <div class="sub-settings" data-bind="visible: parent.editPreRender().ppRollText">
                        <div>
                            <label class="sub">Size</label>
                            <input type="number" step='1' min="1" max="100" width="5" data-bind="value: parent.editPreRender().ppRollTextSize">
                        </div>
                        <div>
                            <label class="sub">Text Color</label>
                            <input type="color" maxlength="7" data-bind="value: parent.editPreRender().ppRollTextForeground">
                        </div>
                        <div>
                            <label class="sub">Background Color</label>
                            <input type="color" maxlength="7" data-bind="value: parent.editPreRender().ppRollTextBackground">
                        </div>
                        <div>
                            <label class="sub">RegEx</label>
                            <input type="text" data-bind="value: parent.editPreRender().ppRollTextRegex">
                            <span class="help-block">
                            This RegEx is applied to the file name. Every matching group creates a new line of text.
                            By that you can extract multiple information (name, filament, temperature, ...) out of the print file name.
                            You can use <a target="_blank" href="https://regex101.com">this tool</a> to verify your RegEx string.
                        </span>
                        </div>
                    </div>

                </div>

                <div>
                    <label class="sub checkbox">
                        <input type="checkbox" data-bind="checked: parent.editPreRender().interpolate">
                        Enable Frame Interpolation
                    </label>
                </div>

                <div class="sub-settings">
                    <div data-bind="visible: parent.editPreRender().interpolate">
                        <label class="sub">Interpolated Framerate</label>
                        <input type="number" step='1' min="1" max="120" width="5" data-bind="value: parent.editPreRender().interpolateFramerate">
                    </div>

                    <div data-bind="visible: parent.editPreRender().interpolate">
                        <label class="sub">Mode</label>
                        <select data-bind="value: parent.editPreRender().interpolateMode">
                            <option value="blend">Blending Frames</option>
                            <option value="mci">Motion Compensated</option>
                        </select>
                    </div>

                    <div class="alert alert-block" style="margin-top: 1em" data-bind="visible: parent.editPreRender().interpolate() && parent.editPreRender().interpolateMode() == 'mci'">
                        <strong>Note: </strong>
                        <a href="http://underpop.online.fr/f/ffmpeg/help/minterpolate.htm.gz" target="_blank">Click here</a>
                        for more information about the interpolation parameters. If you are not sure, you can just keep the default settings.
                    </div>

                    <div data-bind="visible: parent.editPreRender().interpolate() && parent.editPreRender().interpolateMode() == 'mci'">
                        <label class="sub">Motion Estimation</label>
                        <select data-bind="value: parent.editPreRender().interpolateEstimation">
                            <option value="bidir">Bidirectional</option>
                            <option value="bilat">Bilateral</option>
                        </select>
                    </div>

                    <div data-bind="visible: parent.editPreRender().interpolate() && parent.editPreRender().interpolateMode() == 'mci'">
                        <label class="sub">Motion Search Algorithm</label>
                        <select data-bind="value: parent.editPreRender().interpolateAlgorithm">
                            <option value="esa">Exhaustive</option>
                            <option value="tss">Three step</option>
                            <option value="tdls">Two dimensional logarithmic</option>
                            <option value="ntss">New three step</option>
                            <option value="fss">Four step</option>
                            <option value="ds">Diamond</option>
                            <option value="hexbs">Hexagon-based</option>
                            <option value="epzs">Enhanced predictive zonal</option>
                            <option value="umh">Uneven multi-hexagon</option>
                        </select>
                    </div>

                    <div data-bind="visible: parent.editPreRender().interpolate() && parent.editPreRender().interpolateMode() == 'mci'">
                        <label class="sub">Motion Compensation</label>
                        <select data-bind="value: parent.editPreRender().interpolateCompensation">
                            <option value="obmc">Normal</option>
                            <option value="aobmc">Adaptive</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary pull-right" data-dismiss="modal">Close</button>
        </div>
    </div>

</form>

<!------------------------------------------------------->

<div id="tlp-modal-webcam-preview" class="modal hide fade">
    <div class="modal-header">
        <a href="#" class="close" data-dismiss="modal" aria-hidden="true">&times;</a>
        <h3>Webcam Capture</h3>
    </div>
    <div class="modal-body">
        <div class="row-fluid">
            <div class="error"></div>
            <img class="preview" />
            <div class="info">
                <div class="kv-dimensions">
                    <span class="k">Dimensions:</span>
                    <span class="v"></span>
                </div>

                <div class="kv-size">
                    <span class="k">Size:</span>
                    <span class="v"></span>
                </div>

                <div class="kv-time">
                    <span class="k">Capture Time:</span>
                    <span class="v"></span>
                </div>
            </div>
        </div>

    </div>
    <div class="modal-footer">
        <button class="btn btn-primary pull-right" data-dismiss="modal">Close</button>
    </div>
</div>

<div id="tlp-modal-enhancement-live-preview" class="modal hide fade">
    <div class="modal-header">
        <a href="#" class="close" data-dismiss="modal" aria-hidden="true">&times;</a>
        <h3>Live Preview</h3>
    </div>
    <div class="modal-body">
        <div class="row-fluid">
            <img class="preview" />
        </div>

    </div>
    <div class="modal-footer">
        <button class="btn btn-primary pull-right" data-dismiss="modal">Close</button>
    </div>
</div>

<div id="tlp-modal-auto-detect-home" class="modal hide fade">
    <div class="modal-header">
        <a href="#" class="close" data-dismiss="modal" aria-hidden="true">&times;</a>
        <h3>Auto-Detect Home Position</h3>
    </div>
    <div class="modal-body" style="width: 35em">
        <div class="row-fluid">
            <div data-bind="if: !parent.autoDetectHomeStarted()">
                An Auto-Detection of the Home Position can be performed.
                Your printer will be homed via <code>G28</code>. Afer homing, the current position will be queried via <code>M114 D E R</code>.
                Please make sure your printer is connected and your print head is not blocked.
            </div>
            <div data-bind="if: parent.autoDetectHomeRunning()">
                <h4 style="margin-top: 0">Please wait</h4>
                <i style="font-size: 2em" class="fa-solid fa-spinner fa-spin"></i>
            </div>
            <div data-bind="if: parent.autoDetectHomeError() != null && !parent.autoDetectHomeRunning()">
                <h4 style="margin-top: 0">An Error occured</h4>
                <div data-bind="text: parent.autoDetectHomeError"></div>
            </div>
            <div data-bind="if: parent.autoDetectHomeSuccess() && !parent.autoDetectHomeRunning()">
                <h4 style="margin-top: 0">Success</h4>
                The Home Position is:<br><br>
                X: <span data-bind="text: settings.plugins.timelapseplus.stabilizationSettings.printerHomeX"></span><br>
                Y: <span data-bind="text: settings.plugins.timelapseplus.stabilizationSettings.printerHomeY"></span><br>
                Z: <span data-bind="text: settings.plugins.timelapseplus.stabilizationSettings.printerHomeZ"></span><br>
                <br>
                These values have been set as the new Home Position. You can close this window now. But don't forget to save your settings.
            </div>
            <button style="margin-top: 2em" class="btn" data-bind="click: parent.executeHomeAutoDetect, visible: !parent.autoDetectHomeRunning()">
                <i class="fa fa-bullseye"></i>
                Execute Auto-Detection
            </button>
        </div>

    </div>
    <div class="modal-footer">
        <button data-bind="disable: parent.autoDetectHomeRunning()" class="btn btn-primary pull-right" data-dismiss="modal">Close</button>
    </div>
</div>
